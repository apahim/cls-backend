# Google Cloud Platform Configuration
gcp:
  # REQUIRED: GCP Project ID (must match cloud-resources chart)
  project: ""

# Application namespace
namespace:
  name: "cls-system"
  create: true

# Container image configuration
image:
  repository: "gcr.io/apahim-dev-1/cls-backend"
  tag: "latest"
  pullPolicy: Always

# Application deployment configuration
deployment:
  replicas: 3
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 1

# Resource requests and limits
resources:
  requests:
    memory: "128Mi"
    cpu: "100m"
  limits:
    memory: "512Mi"
    cpu: "500m"

# Service configuration
service:
  # Internal ClusterIP service
  type: ClusterIP
  port: 80
  targetPort: 8080

# External LoadBalancer service is always created for API Gateway integration

# External DNS configuration (enabled by default, but only active when hostname is set)
# IMPORTANT: Set externalDns.hostname to your desired DNS name for automatic DNS record creation
externalDns:
  # Enable external-dns integration for automatic DNS record creation
  # NOTE: External DNS annotations are only added when both enabled=true AND hostname is provided
  enabled: true
  # DNS hostname for the service (leave empty to disable external-dns, or set to your desired DNS name)
  # Example: cls-backend.example.com, api.mycompany.com
  hostname: ""
  # DNS zone (optional, used for validation)
  zone: ""
  # TTL for DNS records in seconds (default: 300)
  ttl: 300
  # Additional annotations to pass to external-dns
  annotations: {}
    # external-dns.alpha.kubernetes.io/cloudflare-proxied: "false"
    # external-dns.alpha.kubernetes.io/aws-health-check-id: "health-check-id"

# Database configuration (must match cloud-resources chart)
database:
  # Cloud SQL instance name (must match cloud-resources database.instance.name)
  instanceName: "cls-backend-db"
  # Database name (must match cloud-resources database.database.name)
  databaseName: "cls_backend"
  # Username (must match cloud-resources database.user.name)
  username: "cls_user"
  passwordSecret:
    # Secret name created by cloud-resources ESO Password Generator
    name: "cls-backend-db-password"

# Pub/Sub configuration (must match cloud-resources chart)
pubsub:
  # Topic name (must match cloud-resources pubsub.clusterEventsTopic)
  clusterEventsTopic: "cluster-events"

# Service account configuration (must match cloud-resources chart)
serviceAccount:
  # Kubernetes service account name
  name: "cls-backend"
  # GCP service account name (must match cloud-resources serviceAccount.name)
  gcpServiceAccountName: "cls-backend"
  # Enable Workload Identity annotation
  workloadIdentity: true

# Application configuration
config:
  # Server configuration
  port: 8080
  environment: "production"
  logLevel: "info"
  logFormat: "json"

  # Metrics
  metricsEnabled: true
  metricsPort: 8081

  # Authentication
  disableAuth: false

  # Reconciliation configuration
  reconciliation:
    enabled: true
    checkInterval: "1m"
    maxConcurrent: 50
    adaptiveEnabled: true
    healthyInterval: "5m"
    unhealthyInterval: "30s"
    defaultInterval: "5m"

  # Aggregation configuration
  aggregation:
    enabled: true
    interval: "30s"
    batchSize: 50
    maxConcurrency: 10
    retryAttempts: 3
    retryBackoff: "5s"

# Pod security context
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1001
  fsGroup: 1001

# Container security context
securityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: true
  capabilities:
    drop:
      - ALL

# Liveness and readiness probes
probes:
  liveness:
    enabled: true
    initialDelaySeconds: 30
    periodSeconds: 30
    timeoutSeconds: 10
    failureThreshold: 3
  readiness:
    enabled: true
    initialDelaySeconds: 10
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

# Pod anti-affinity (prefer spreading across nodes)
affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app.kubernetes.io/name
                operator: In
                values:
                  - cls-backend
          topologyKey: kubernetes.io/hostname

# External Secrets Operator configuration
externalSecrets:
  refreshInterval: "1h"

# Labels applied to all resources
commonLabels:
  app.kubernetes.io/name: cls-backend
  app.kubernetes.io/component: application
  app.kubernetes.io/part-of: cls-backend
  app.kubernetes.io/managed-by: helm